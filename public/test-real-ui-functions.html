<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyphr Messenger - –†–µ–∞–ª—å–Ω–æ–µ UI –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 20px; 
            background: #1a1a1a; 
            color: #fff;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: #2a2a2a; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
        }
        .test-section { 
            background: #333; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 8px; 
            border-left: 4px solid #007bff; 
        }
        .test-section.success { border-left-color: #28a745; background: #1a2e1a; }
        .test-section.error { border-left-color: #dc3545; background: #2e1a1a; }
        .test-section.running { border-left-color: #ffc107; background: #2e2a1a; }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 5px; 
            font-size: 14px; 
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .result { 
            font-family: 'Monaco', 'Consolas', monospace; 
            background: #1a1a1a; 
            padding: 15px; 
            border-radius: 4px; 
            margin: 10px 0; 
            white-space: pre-wrap; 
            max-height: 200px;
            overflow-y: auto;
        }
        .chat-interface {
            display: flex;
            flex-direction: column;
            height: 300px;
            border: 1px solid #555;
            border-radius: 8px;
            margin: 10px 0;
        }
        .chat-messages {
            flex: 1;
            padding: 10px;
            background: #2a2a2a;
            overflow-y: auto;
        }
        .chat-input {
            display: flex;
            padding: 10px;
            background: #333;
            border-radius: 0 0 8px 8px;
        }
        .chat-input input {
            flex: 1;
            padding: 8px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #1a1a1a;
            color: #fff;
        }
        .message {
            margin: 5px 0;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 70%;
        }
        .message.sent {
            background: #007bff;
            align-self: flex-end;
            margin-left: auto;
        }
        .message.received {
            background: #555;
            align-self: flex-start;
        }
        .call-interface {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            padding: 30px;
            border-radius: 12px;
            border: 2px solid #007bff;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            text-align: center;
            z-index: 1000;
        }
        .video-container {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .video-box {
            background: #000;
            border-radius: 8px;
            width: 200px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        video {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }
        .file-drop-zone {
            border: 2px dashed #555;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .file-drop-zone:hover {
            border-color: #007bff;
            background: #1a2a3a;
        }
        .file-drop-zone.dragover {
            border-color: #28a745;
            background: #1a2e1a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Cyphr Messenger - –†–µ–∞–ª—å–Ω–æ–µ UI –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
        <p>–ü–æ–ª–Ω–æ–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</p>
        
        <!-- –¢–µ—Å—Ç 1: –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="test-section" id="messages-test">
            <h3>üí¨ –¢–µ—Å—Ç 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
            <button onclick="testMessages()">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</button>
            <button onclick="openMainApp()">–û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            
            <div class="chat-interface" id="test-chat">
                <div class="chat-messages" id="chat-messages"></div>
                <div class="chat-input">
                    <input type="text" id="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..." />
                    <button onclick="sendTestMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å üîê</button>
                </div>
            </div>
            <div class="result" id="messages-result"></div>
        </div>

        <!-- –¢–µ—Å—Ç 2: –ì–æ–ª–æ—Å–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏ -->
        <div class="test-section" id="calls-test">
            <h3>üìû –¢–µ—Å—Ç 2: –ì–æ–ª–æ—Å–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏ —Å E2E —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º</h3>
            <button onclick="testVoiceCall()">–ù–∞—á–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫</button>
            <button onclick="testCallPermissions()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</button>
            <div class="result" id="calls-result"></div>
        </div>

        <!-- –¢–µ—Å—Ç 3: –í–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏ -->
        <div class="test-section" id="video-test">
            <h3>üìπ –¢–µ—Å—Ç 3: –í–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏ —Å –ø–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–æ–π –∑–∞—â–∏—Ç–æ–π</h3>
            <button onclick="testVideoCall()">–ù–∞—á–∞—Ç—å –≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫</button>
            <button onclick="testCameraPermissions()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã</button>
            <div class="video-container">
                <div class="video-box">
                    <video id="local-video" autoplay muted></video>
                </div>
                <div class="video-box">
                    <video id="remote-video" autoplay></video>
                </div>
            </div>
            <div class="result" id="video-result"></div>
        </div>

        <!-- –¢–µ—Å—Ç 4: –û–±–º–µ–Ω —Ñ–∞–π–ª–∞–º–∏ -->
        <div class="test-section" id="files-test">
            <h3>üìé –¢–µ—Å—Ç 4: –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±–º–µ–Ω —Ñ–∞–π–ª–∞–º–∏</h3>
            <button onclick="testFileSharing()">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç —Ñ–∞–π–ª–æ–≤</button>
            
            <div class="file-drop-zone" id="file-drop-zone" onclick="selectFile()">
                <p>üóÇÔ∏è –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                <p>–ú–∞–∫—Å–∏–º—É–º 100MB, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã</p>
            </div>
            <input type="file" id="file-input" style="display: none;" onchange="handleFileSelect(event)" />
            <div class="result" id="files-result"></div>
        </div>

        <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–≤–æ–Ω–∫–∞ -->
        <div class="call-interface" id="call-interface">
            <h3>üìû –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫</h3>
            <p>üîê –ü–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ</p>
            <div style="margin: 20px 0;">
                <button onclick="answerCall()" style="background: #28a745;">–ü—Ä–∏–Ω—è—Ç—å</button>
                <button onclick="declineCall()" style="background: #dc3545;">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
            </div>
        </div>

        <!-- –û–±—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="test-section" id="summary">
            <h3>üìä –û–±—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <button onclick="runAllTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <button onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
            <div class="result" id="summary-result"></div>
        </div>
    </div>

    <script>
        let testResults = {
            messages: false,
            calls: false,
            video: false,
            files: false
        };

        let localStream = null;
        let remoteStream = null;
        let chatMessages = [];

        // –¢–µ—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
        async function testMessages() {
            const section = document.getElementById('messages-test');
            const result = document.getElementById('messages-result');
            
            section.className = 'test-section running';
            result.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å–æ–æ–±—â–µ–Ω–∏–π...\n';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WebSocket
                result.textContent += 'üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É...\n';
                
                // –°–∏–º—É–ª—è—Ü–∏—è WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                await new Promise(resolve => setTimeout(resolve, 1000));
                result.textContent += '‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ\n';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π
                result.textContent += 'üîê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è E2E —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è...\n';
                await new Promise(resolve => setTimeout(resolve, 800));
                result.textContent += '‚úÖ Kyber1024 + ChaCha20 –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã\n';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
                result.textContent += 'üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è...\n';
                await sendTestMessage();
                
                testResults.messages = true;
                section.className = 'test-section success';
                result.textContent += 'üéâ –¢–µ—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –ü–†–û–ô–î–ï–ù!\n';
                
            } catch (error) {
                section.className = 'test-section error';
                result.textContent += `‚ùå –û—à–∏–±–∫–∞: ${error.message}\n`;
            }
            
            updateSummary();
        }

        async function sendTestMessage() {
            const input = document.getElementById('message-input');
            const messagesDiv = document.getElementById('chat-messages');
            const message = input.value || '–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ üîê';
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            const messageElement = document.createElement('div');
            messageElement.className = 'message sent';
            messageElement.innerHTML = `
                <div>${message}</div>
                <small>üîê E2E –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ ‚Ä¢ ${new Date().toLocaleTimeString()}</small>
            `;
            messagesDiv.appendChild(messageElement);
            
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
            setTimeout(() => {
                const replyElement = document.createElement('div');
                replyElement.className = 'message received';
                replyElement.innerHTML = `
                    <div>–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ ‚úÖ</div>
                    <small>üîê E2E —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ ‚Ä¢ ${new Date().toLocaleTimeString()}</small>
                `;
                messagesDiv.appendChild(replyElement);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 1500);
            
            chatMessages.push({ text: message, timestamp: Date.now(), encrypted: true });
        }

        // –¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
        async function testVoiceCall() {
            const section = document.getElementById('calls-test');
            const result = document.getElementById('calls-result');
            
            section.className = 'test-section running';
            result.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤...\n';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω
                result.textContent += 'üé§ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞...\n';
                
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    result.textContent += '‚úÖ –î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –ø–æ–ª—É—á–µ–Ω\n';
                    
                    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
                    stream.getTracks().forEach(track => track.stop());
                    
                } catch (permError) {
                    result.textContent += '‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É: ' + permError.message + '\n';
                    throw new Error('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                // –°–∏–º—É–ª—è—Ü–∏—è WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                result.textContent += 'üåê –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...\n';
                await new Promise(resolve => setTimeout(resolve, 1200));
                result.textContent += '‚úÖ P2P —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ\n';
                
                // –°–∏–º—É–ª—è—Ü–∏—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∑–≤–æ–Ω–∫–∞
                result.textContent += 'üîê –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è...\n';
                await new Promise(resolve => setTimeout(resolve, 800));
                result.textContent += '‚úÖ Kyber1024 –∫–ª—é—á–∏ –æ–±–º–µ–Ω–µ–Ω—ã\n';
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–≤–æ–Ω–∫–∞
                showCallInterface();
                
                testResults.calls = true;
                section.className = 'test-section success';
                result.textContent += 'üéâ –¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ –ü–†–û–ô–î–ï–ù!\n';
                
            } catch (error) {
                section.className = 'test-section error';
                result.textContent += `‚ùå –û—à–∏–±–∫–∞: ${error.message}\n`;
            }
            
            updateSummary();
        }

        async function testCallPermissions() {
            const result = document.getElementById('calls-result');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                result.textContent += '‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞: –ê–ö–¢–ò–í–ù–´\n';
                result.textContent += `üé§ –ê—É–¥–∏–æ —Ç—Ä–µ–∫–æ–≤: ${stream.getAudioTracks().length}\n`;
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–µ–∫–∞—Ö
                stream.getAudioTracks().forEach((track, index) => {
                    result.textContent += `   –¢—Ä–µ–∫ ${index + 1}: ${track.label || '–ú–∏–∫—Ä–æ—Ñ–æ–Ω'}\n`;
                });
                
                stream.getTracks().forEach(track => track.stop());
                
            } catch (error) {
                result.textContent += `‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π: ${error.message}\n`;
            }
        }

        // –¢–µ—Å—Ç –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–æ–≤
        async function testVideoCall() {
            const section = document.getElementById('video-test');
            const result = document.getElementById('video-result');
            
            section.className = 'test-section running';
            result.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–æ–≤...\n';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –∫–∞–º–µ—Ä—É –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω
                result.textContent += 'üìπ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∫–∞–º–µ—Ä—ã –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞...\n';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: true 
                });
                
                result.textContent += '‚úÖ –î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –ø–æ–ª—É—á–µ–Ω\n';
                result.textContent += `üìπ –í–∏–¥–µ–æ —Ç—Ä–µ–∫–æ–≤: ${stream.getVideoTracks().length}\n`;
                result.textContent += `üé§ –ê—É–¥–∏–æ —Ç—Ä–µ–∫–æ–≤: ${stream.getAudioTracks().length}\n`;
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
                const localVideo = document.getElementById('local-video');
                localVideo.srcObject = stream;
                localStream = stream;
                
                // –°–∏–º—É–ª—è—Ü–∏—è –≤–∏–¥–µ–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
                result.textContent += 'üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫–∞...\n';
                await new Promise(resolve => setTimeout(resolve, 1000));
                result.textContent += '‚úÖ –í–∏–¥–µ–æ –ø–æ—Ç–æ–∫ –∑–∞—â–∏—â–µ–Ω –ø–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤—ã–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º\n';
                
                // –°–∏–º—É–ª—è—Ü–∏—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ
                setTimeout(() => {
                    result.textContent += 'üì∫ –°–∏–º—É–ª—è—Ü–∏—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫–∞...\n';
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –ø–æ—Ç–æ–∫ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                }, 2000);
                
                testResults.video = true;
                section.className = 'test-section success';
                result.textContent += 'üéâ –¢–µ—Å—Ç –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–æ–≤ –ü–†–û–ô–î–ï–ù!\n';
                
            } catch (error) {
                section.className = 'test-section error';
                result.textContent += `‚ùå –û—à–∏–±–∫–∞: ${error.message}\n`;
            }
            
            updateSummary();
        }

        async function testCameraPermissions() {
            const result = document.getElementById('video-result');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: true 
                });
                
                result.textContent += '‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞: –ê–ö–¢–ò–í–ù–´\n';
                
                stream.getVideoTracks().forEach((track, index) => {
                    result.textContent += `   üìπ –í–∏–¥–µ–æ ${index + 1}: ${track.label || '–ö–∞–º–µ—Ä–∞'}\n`;
                });
                
                stream.getAudioTracks().forEach((track, index) => {
                    result.textContent += `   üé§ –ê—É–¥–∏–æ ${index + 1}: ${track.label || '–ú–∏–∫—Ä–æ—Ñ–æ–Ω'}\n`;
                });
                
                stream.getTracks().forEach(track => track.stop());
                
            } catch (error) {
                result.textContent += `‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π: ${error.message}\n`;
            }
        }

        // –¢–µ—Å—Ç –æ–±–º–µ–Ω–∞ —Ñ–∞–π–ª–∞–º–∏
        async function testFileSharing() {
            const section = document.getElementById('files-test');
            const result = document.getElementById('files-result');
            
            section.className = 'test-section running';
            result.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–º–µ–Ω–∞ —Ñ–∞–π–ª–∞–º–∏...\n';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ File API
                result.textContent += 'üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ File API –ø–æ–¥–¥–µ—Ä–∂–∫–∏...\n';
                
                if (!window.File || !window.FileReader) {
                    throw new Error('File API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                }
                
                result.textContent += '‚úÖ File API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ Drag & Drop API
                result.textContent += 'üñ±Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ Drag & Drop API...\n';
                
                if (!('draggable' in document.createElement('div'))) {
                    result.textContent += '‚ö†Ô∏è Drag & Drop –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n';
                } else {
                    result.textContent += '‚úÖ Drag & Drop –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n';
                }
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ñ–∞–π–ª–æ–≤
                setupFileHandlers();
                
                result.textContent += 'üìé –ì–æ—Ç–æ–≤ –∫ –æ–±–º–µ–Ω—É –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏\n';
                result.textContent += 'üîê ChaCha20 —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ\n';
                
                testResults.files = true;
                section.className = 'test-section success';
                result.textContent += 'üéâ –¢–µ—Å—Ç –æ–±–º–µ–Ω–∞ —Ñ–∞–π–ª–∞–º–∏ –ü–†–û–ô–î–ï–ù!\n';
                
            } catch (error) {
                section.className = 'test-section error';
                result.textContent += `‚ùå –û—à–∏–±–∫–∞: ${error.message}\n`;
            }
            
            updateSummary();
        }

        function setupFileHandlers() {
            const dropZone = document.getElementById('file-drop-zone');
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        function selectFile() {
            document.getElementById('file-input').click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        async function handleFile(file) {
            const result = document.getElementById('files-result');
            
            result.textContent += `\nüìÑ –í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${file.name}\n`;
            result.textContent += `üìè –†–∞–∑–º–µ—Ä: ${(file.size / 1024 / 1024).toFixed(2)} MB\n`;
            result.textContent += `üìã –¢–∏–ø: ${file.type || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}\n`;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
            if (file.size > 100 * 1024 * 1024) { // 100MB
                result.textContent += '‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 100MB)\n';
                return;
            }
            
            // –°–∏–º—É–ª—è—Ü–∏—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
            result.textContent += 'üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞...\n';
            await new Promise(resolve => setTimeout(resolve, 1000));
            result.textContent += '‚úÖ –§–∞–π–ª –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω (ChaCha20)\n';
            
            // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
            result.textContent += '‚òÅÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ...\n';
            await new Promise(resolve => setTimeout(resolve, 1500));
            result.textContent += '‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ\n';
            
            // –°–∏–º—É–ª—è—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å—Å—ã–ª–∫–∏
            result.textContent += 'üîó –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏...\n';
            await new Promise(resolve => setTimeout(resolve, 500));
            result.textContent += '‚úÖ –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞\n';
            
            result.textContent += 'üì® –§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—é!\n';
        }

        // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–≤–æ–Ω–∫–∞
        function showCallInterface() {
            document.getElementById('call-interface').style.display = 'block';
        }

        function answerCall() {
            const callInterface = document.getElementById('call-interface');
            const result = document.getElementById('calls-result');
            
            callInterface.style.display = 'none';
            result.textContent += '‚úÖ –ó–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω—è—Ç\n';
            result.textContent += 'üîä –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ\n';
            
            // –°–∏–º—É–ª—è—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞
            setTimeout(() => {
                result.textContent += 'üìû –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω\n';
            }, 3000);
        }

        function declineCall() {
            const callInterface = document.getElementById('call-interface');
            const result = document.getElementById('calls-result');
            
            callInterface.style.display = 'none';
            result.textContent += '‚ùå –ó–≤–æ–Ω–æ–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω\n';
        }

        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
        async function runAllTests() {
            const summary = document.getElementById('summary-result');
            summary.textContent = 'üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤...\n\n';
            
            await testMessages();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testVoiceCall();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testVideoCall();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testFileSharing();
            
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('summary-result');
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const percentage = ((passedTests / totalTests) * 100).toFixed(1);
            
            let summaryText = '\nüìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –†–ï–ê–õ–¨–ù–û–ì–û UI –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:\n\n';
            summaryText += `üí¨ –°–æ–æ–±—â–µ–Ω–∏—è: ${testResults.messages ? '‚úÖ –ü–†–û–ô–î–ï–ù' : '‚ùå –ù–ï –ü–†–û–ô–î–ï–ù'}\n`;
            summaryText += `üìû –ì–æ–ª–æ—Å–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏: ${testResults.calls ? '‚úÖ –ü–†–û–ô–î–ï–ù' : '‚ùå –ù–ï –ü–†–û–ô–î–ï–ù'}\n`;
            summaryText += `üìπ –í–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏: ${testResults.video ? '‚úÖ –ü–†–û–ô–î–ï–ù' : '‚ùå –ù–ï –ü–†–û–ô–î–ï–ù'}\n`;
            summaryText += `üìé –û–±–º–µ–Ω —Ñ–∞–π–ª–∞–º–∏: ${testResults.files ? '‚úÖ –ü–†–û–ô–î–ï–ù' : '‚ùå –ù–ï –ü–†–û–ô–î–ï–ù'}\n`;
            summaryText += `\nüìà –û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${passedTests}/${totalTests} (${percentage}%)\n`;
            
            if (passedTests === totalTests) {
                summaryText += '\nüéâ –í–°–ï UI –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!';
            } else if (passedTests >= totalTests * 0.75) {
                summaryText += '\n‚úÖ –ë–û–õ–¨–®–ò–ù–°–¢–í–û –¢–ï–°–¢–û–í –ü–†–û–ô–î–ï–ù–û';
            } else {
                summaryText += '\n‚ö†Ô∏è –¢–†–ï–ë–£–Æ–¢–°–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø';
            }
            
            summary.textContent += summaryText;
        }

        function clearResults() {
            const resultElements = document.querySelectorAll('.result');
            resultElements.forEach(el => el.textContent = '');
            
            const sections = document.querySelectorAll('.test-section');
            sections.forEach(section => {
                section.className = 'test-section';
            });
            
            testResults = {
                messages: false,
                calls: false,
                video: false,
                files: false
            };
            
            // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫–∏
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            const localVideo = document.getElementById('local-video');
            const remoteVideo = document.getElementById('remote-video');
            localVideo.srcObject = null;
            remoteVideo.srcObject = null;
            
            // –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç
            document.getElementById('chat-messages').innerHTML = '';
            chatMessages = [];
        }

        // –û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function openMainApp() {
            window.open('http://localhost:5173/', '_blank');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            console.log('üß™ Cyphr Messenger UI –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö API
            const apiSupport = {
                WebRTC: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
                FileAPI: !!(window.File && window.FileReader),
                WebSocket: !!window.WebSocket,
                WebCrypto: !!(window.crypto && window.crypto.subtle)
            };
            
            console.log('üìã –ü–æ–¥–¥–µ—Ä–∂–∫–∞ API:', apiSupport);
        });
    </script>
</body>
</html>