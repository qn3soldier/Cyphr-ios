<!DOCTYPE html>
<html>
<head>
    <title>Cyphr Messenger Group Management Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { margin: 5px; padding: 10px; }
        input { margin: 5px; padding: 8px; width: 200px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>Cyphr Messenger Group Management Test</h1>
    
    <div class="section">
        <h3>üõ°Ô∏è Authentication Test</h3>
        <input type="text" id="authToken" placeholder="JWT Token (–¥–ª—è —Ç–µ—Å—Ç–∞)" value="test-token">
        <button onclick="testAuth()">Test Authentication</button>
        <div id="authResult" class="result"></div>
    </div>
    
    <div class="section">
        <h3>üë• Group Members Management</h3>
        <input type="text" id="chatId" placeholder="Chat ID" value="test-chat-123">
        <input type="text" id="userId" placeholder="User ID" value="test-user-456">
        <br>
        <button onclick="getMembers()">Get Members</button>
        <button onclick="addMember()">Add Member</button>
        <button onclick="removeMember()">Remove Member</button>
        <button onclick="changeRole()">Change Role</button>
        <div id="membersResult" class="result"></div>
    </div>
    
    <div class="section">
        <h3>üö´ Ban Management</h3>
        <input type="text" id="banReason" placeholder="Ban Reason" value="Spam/inappropriate behavior">
        <br>
        <button onclick="banMember()">Ban Member</button>
        <button onclick="unbanMember()">Unban Member</button>
        <div id="banResult" class="result"></div>
    </div>
    
    <div class="section">
        <h3>üìä API Health Check</h3>
        <button onclick="checkHealth()">Check API Health</button>
        <div id="healthResult" class="result"></div>
    </div>

    <script>
        const API_BASE = 'https://app.cyphrmessenger.app/api';
        
        function getAuthHeaders() {
            const token = document.getElementById('authToken').value;
            return {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            };
        }
        
        function getChatId() {
            return document.getElementById('chatId').value;
        }
        
        function getUserId() {
            return document.getElementById('userId').value;
        }
        
        function displayResult(elementId, result, isError = false) {
            const element = document.getElementById(elementId);
            element.className = `result ${isError ? 'error' : 'success'}`;
            element.innerHTML = `
                <div><strong>Time:</strong> ${new Date().toLocaleTimeString()}</div>
                <div><strong>Result:</strong></div>
                <pre>${JSON.stringify(result, null, 2)}</pre>
            `;
        }
        
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: getAuthHeaders(),
                    ...options
                });
                
                const data = await response.json();
                return { response, data, status: response.status };
            } catch (error) {
                return { error: error.message, status: 0 };
            }
        }
        
        async function testAuth() {
            const result = await makeRequest(`${API_BASE}/health`);
            displayResult('authResult', {
                status: result.status,
                authenticated: result.status === 200,
                data: result.data || result.error
            }, result.status !== 200);
        }
        
        async function checkHealth() {
            const result = await makeRequest(`${API_BASE}/health`);
            displayResult('healthResult', result, result.status !== 200);
        }
        
        async function getMembers() {
            const chatId = getChatId();
            const result = await makeRequest(`${API_BASE}/chats/${chatId}/members`);
            displayResult('membersResult', result, result.status !== 200);
        }
        
        async function addMember() {
            const chatId = getChatId();
            const userId = getUserId();
            
            const result = await makeRequest(`${API_BASE}/chats/${chatId}/members/${userId}`, {
                method: 'POST',
                body: JSON.stringify({
                    role: 'member'
                })
            });
            
            displayResult('membersResult', result, result.status !== 200);
        }
        
        async function removeMember() {
            const chatId = getChatId();
            const userId = getUserId();
            
            const result = await makeRequest(`${API_BASE}/chats/${chatId}/members/${userId}`, {
                method: 'DELETE'
            });
            
            displayResult('membersResult', result, result.status !== 200);
        }
        
        async function changeRole() {
            const chatId = getChatId();
            const userId = getUserId();
            
            const result = await makeRequest(`${API_BASE}/chats/${chatId}/members/${userId}/role`, {
                method: 'PUT',
                body: JSON.stringify({
                    role: 'admin'
                })
            });
            
            displayResult('membersResult', result, result.status !== 200);
        }
        
        async function banMember() {
            const chatId = getChatId();
            const userId = getUserId();
            const reason = document.getElementById('banReason').value;
            
            const result = await makeRequest(`${API_BASE}/chats/${chatId}/ban/${userId}`, {
                method: 'POST',
                body: JSON.stringify({
                    reason: reason,
                    duration: null // permanent ban
                })
            });
            
            displayResult('banResult', result, result.status !== 200);
        }
        
        async function unbanMember() {
            const chatId = getChatId();
            const userId = getUserId();
            
            const result = await makeRequest(`${API_BASE}/chats/${chatId}/ban/${userId}`, {
                method: 'DELETE'
            });
            
            displayResult('banResult', result, result.status !== 200);
        }
        
        // Test API health on page load
        window.onload = function() {
            checkHealth();
        };
    </script>
</body>
</html>